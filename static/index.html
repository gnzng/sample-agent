<!DOCTYPE html>
<html>
    <head>
        <title>Web Terminal</title>
        <link rel="stylesheet" href="https://unpkg.com/xterm@5.1.0/css/xterm.css">
        <script src="https://unpkg.com/xterm@5.1.0/lib/xterm.js"></script>
        <script src="https://unpkg.com/xterm-addon-fit@0.7.0/lib/xterm-addon-fit.js"></script>
        <style>
            /* Add these styles */
            #terminal {
                width: 100%;
                height: 100vh;
                padding: 20px;
                background: #1e1e1e;
            }
            html, body {
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
        </style>
    </head>
<body>
<div id="terminal"></div>
<script>
    const term = new Terminal({
      // Enable EOL conversion (critical for line breaks)
      convertEol: true,  // <--- Add this option
      fontFamily: 'monospace',
      rows: 30,
      theme: { background: '#1e1e1e' }
    });
  
    term.open(document.getElementById('terminal'));
    const ws = new WebSocket('ws://localhost:8000/ws');
    let inputBuffer = '';
  
    // Handle server output
    ws.onmessage = (event) => {
      term.write(event.data.replace(/\n/g, '\r\n'));  // Force \r\n line endings
    };
  
    // Handle user input
    term.onData((data) => {
      if (data === '\r') {  // Enter pressed
        ws.send(inputBuffer + '\n');
        inputBuffer = '';
        term.write('\r\n');  // Explicit \r\n for new line
      } else if (data === '\x7f') {  // Backspace
        if (inputBuffer.length > 0) {
          inputBuffer = inputBuffer.slice(0, -1);
          term.write('\b \b');  // Backspace + erase
        }
      } else {
        inputBuffer += data;
        term.write(data);  // Echo character
      }
    });
  </script>
</body>
</html>
